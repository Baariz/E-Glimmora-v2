---
phase: 05-platform-administration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/(admin)/layout.tsx
  - src/app/(admin)/dashboard/page.tsx
  - src/app/(admin)/invites/page.tsx
  - src/components/admin/invites/GenerateInviteModal.tsx
  - src/components/admin/invites/InviteCodeDetail.tsx
  - src/lib/services/interfaces/IInviteCodeService.ts
  - src/lib/services/mock/invite-code.mock.ts
autonomous: true

must_haves:
  truths:
    - "Super Admin can view admin dashboard with platform stats (invite count, member count, institution count, system health)"
    - "Super Admin can view all invite codes in a sortable, searchable DataTable with status badges"
    - "Super Admin can generate a new invite code with configurable type (B2C/B2B/Admin), max uses, and expiry"
    - "Super Admin can track invite code status (active/used/expired) with usage count and creation date"
    - "Super Admin can revoke an active invite code"
    - "Admin layout has functional navigation with active route highlighting and logout"
  artifacts:
    - path: "src/app/(admin)/layout.tsx"
      provides: "Enhanced admin layout with active route highlighting, responsive nav"
      min_lines: 80
    - path: "src/app/(admin)/dashboard/page.tsx"
      provides: "Full admin dashboard with live stats from services"
      min_lines: 100
    - path: "src/app/(admin)/invites/page.tsx"
      provides: "Invite management page with DataTable, stats, generate modal"
      min_lines: 150
    - path: "src/components/admin/invites/GenerateInviteModal.tsx"
      provides: "Modal for generating invite codes with type/uses/expiry config"
      min_lines: 80
    - path: "src/components/admin/invites/InviteCodeDetail.tsx"
      provides: "Expandable detail panel for individual invite code"
      min_lines: 60
  key_links:
    - from: "src/app/(admin)/invites/page.tsx"
      to: "useServices().inviteCode"
      via: "useServices hook for CRUD operations"
      pattern: "services\\.inviteCode"
    - from: "src/components/admin/invites/GenerateInviteModal.tsx"
      to: "services.inviteCode.createInviteCode"
      via: "service call on form submit"
      pattern: "createInviteCode"
    - from: "src/app/(admin)/invites/page.tsx"
      to: "DataTable component"
      via: "TanStack Table wrapper import"
      pattern: "DataTable"
---

<objective>
Enhance the admin layout with functional navigation and build complete invite code management for the Super Admin platform.

Purpose: Establishes the admin operations foundation and delivers ADMN-01 (invite code generation) and ADMN-02 (invite code tracking) — the first functional admin workflows.
Output: Enhanced admin layout, full admin dashboard with real stats, and invite management page with DataTable, generate modal, status tracking, and revoke capability.
</objective>

<execution_context>
@/Users/kavi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kavi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Key references:
@src/app/(admin)/layout.tsx — Current admin layout (basic top nav, needs active route highlighting)
@src/app/(admin)/dashboard/page.tsx — Current placeholder dashboard (needs real service data)
@src/components/b2b/tables/DataTable.tsx — TanStack Table wrapper to reuse
@src/components/b2b/layouts/StatsRow.tsx — Stats row component to reuse
@src/components/b2b/layouts/StatusBadge.tsx — Status badge component to reuse
@src/components/shared/Modal.tsx — Modal component for generate invite
@src/lib/services/mock/invite-code.mock.ts — Existing mock service (needs enhancement for revoke, expiry)
@src/lib/services/interfaces/IInviteCodeService.ts — Service interface (needs revokeInviteCode method)
@src/lib/hooks/useServices.ts — Service access hook
@src/lib/types/entities.ts — InviteCode entity type
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance admin layout and build full dashboard</name>
  <files>
    src/app/(admin)/layout.tsx
    src/app/(admin)/dashboard/page.tsx
  </files>
  <action>
  **Admin Layout Enhancement (layout.tsx):**

  Enhance the existing admin layout with:
  1. Active route highlighting using `usePathname()` — current nav link gets `text-gray-900 font-medium border-b-2 border-gray-900` styling, others stay `text-gray-600`
  2. Add `'use client'` directive since it now uses hooks
  3. Keep the existing clean operational aesthetic (gray/white palette, functional feel)
  4. Mobile responsive: add hamburger menu for nav links on small screens (use useState toggle, simple sliding panel)
  5. Keep the ContextSwitcher component in nav
  6. Connect Logout button to signOut from next-auth (import from `next-auth/react`)

  **Admin Dashboard (dashboard/page.tsx):**

  Replace the placeholder dashboard with a full admin overview that loads real data from services:
  1. Use `useServices()` hook to get inviteCode, user, institution, and audit services
  2. Load data in `useEffect` on mount — get invite codes, users, institutions, recent audit events
  3. Display 4 stat cards in a grid:
     - Invite Codes: total count, with breakdown of active/used/expired
     - Active Members: count of users with non-erased status
     - Institutions: count with breakdown by status (Active/Pending/Suspended)
     - System Health: hardcoded "Operational" for now (Phase 5 Plan 3 adds real monitoring)
  4. Recent Activity section: show last 10 audit events from audit service, formatted as timeline items with colored dots (green=CREATE, blue=READ, amber=UPDATE, red=DELETE, teal=APPROVE), event description, user ID (truncated), and relative timestamp using `date-fns` `formatDistanceToNow`
  5. Quick Actions grid: 3 cards linking to /invites ("Generate Invite"), /members ("Manage Members"), /institutions ("Onboard Institution") — each with a brief description and arrow icon
  6. Use Card component from shared, font-serif for headings, font-sans for body text
  7. Add loading state with skeleton while data loads
  </action>
  <verify>
  - `npm run build` completes without errors
  - Admin layout renders with nav links and active route highlighting works when navigating
  - Dashboard loads and displays stats from services
  - Recent activity shows formatted audit events
  </verify>
  <done>
  Admin layout has active route highlighting, mobile hamburger menu, and functional logout. Dashboard displays live stats from services (invite count, member count, institution count), recent audit activity timeline, and quick action links.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build invite management page with DataTable and generate modal</name>
  <files>
    src/app/(admin)/invites/page.tsx
    src/components/admin/invites/GenerateInviteModal.tsx
    src/components/admin/invites/InviteCodeDetail.tsx
    src/lib/services/interfaces/IInviteCodeService.ts
    src/lib/services/mock/invite-code.mock.ts
  </files>
  <action>
  **Service Enhancement:**

  1. Add `revokeInviteCode(id: string): Promise<InviteCode>` to IInviteCodeService interface
  2. Implement in MockInviteCodeService: sets status to 'revoked', saves to storage
  3. Enhance MockInviteCodeService seed data: add 8-10 more invite codes with varied statuses (active, used, expired, revoked), types (b2c, b2b, admin), different creation dates (spread over last 30 days), and varying usedCount/maxUses ratios. Include some with `expiresAt` dates.

  **GenerateInviteModal Component:**

  Create `src/components/admin/invites/GenerateInviteModal.tsx`:
  1. Modal (using shared Modal component) with form fields:
     - Invite Type: select dropdown with options B2C (UHNI), B2B (select sub-role: RM, PrivateBanker, FamilyOfficeDirector, ComplianceOfficer, InstitutionalAdmin, UHNIPortal), Admin (SuperAdmin)
     - When B2B selected, show a second dropdown for the specific B2B role
     - Max Uses: number input, default 1, min 1, max 1000
     - Expires In: select dropdown with options: 7 days, 14 days, 30 days, 60 days, 90 days, Never
     - Institution ID: text input, shown only when type is 'b2b' (optional for scoping)
  2. On submit: call services.inviteCode.createInviteCode with computed assignedRoles based on type/role selection
  3. On success: show the generated code in a "success" view within the modal — display the code prominently (large monospace text), with a "Copy to Clipboard" button using navigator.clipboard.writeText. Show a toast (sonner) on copy success.
  4. Cancel and Close buttons in footer
  5. Use `createdBy: 'super-admin'` as the creator ID

  **InviteCodeDetail Component:**

  Create `src/components/admin/invites/InviteCodeDetail.tsx`:
  1. Expandable panel showing invite code details when clicking a row
  2. Display: full code (monospace), type, assigned roles, created by, created date, expiry date, usage (usedCount/maxUses bar), status
  3. Actions: "Copy Code" button, "Revoke" button (only for active codes, with confirmation via window.confirm)
  4. Revoke calls services.inviteCode.revokeInviteCode(id), triggers refresh

  **Invite Management Page (invites/page.tsx):**

  Create `src/app/(admin)/invites/page.tsx`:
  1. Page header: "Invite Codes" (font-serif, text-3xl) with description, "Generate Invite" primary button top-right
  2. Stats row (using StatsRow pattern from B2B): Total Codes, Active, Used, Expired, Revoked — computed from loaded data
  3. DataTable (using B2B DataTable component) with columns:
     - Code: monospace, truncated with copy icon
     - Type: badge (rose for b2c, teal for b2b, slate for admin)
     - Status: StatusBadge (green=active, gray=used, amber=expired, red=revoked)
     - Uses: "usedCount / maxUses" format
     - Created: relative date using formatDistanceToNow
     - Expires: relative date or "Never"
     - Actions: expand row to show InviteCodeDetail
  4. Search by code column
  5. Loading state while fetching
  6. Clicking "Generate Invite" opens GenerateInviteModal
  7. On modal close (after success), refresh the invite list
  8. Use `useServices()` hook for data access
  </action>
  <verify>
  - `npm run build` completes without errors
  - Invite page renders with DataTable showing seeded invite codes
  - Generate modal opens, creates code, shows success with copy button
  - Status badges display correctly per status
  - Stats row shows accurate counts
  - Revoke functionality changes invite status
  </verify>
  <done>
  Super Admin can view all invite codes in searchable DataTable with status badges, generate new invite codes with configurable type/uses/expiry, copy generated codes, track status (active/used/expired/revoked) with usage history, and revoke active codes. Stats row shows aggregate counts.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` — no TypeScript errors, no build failures
2. Navigate to /dashboard — shows platform stats loaded from services
3. Navigate to /invites — DataTable with invite codes, stats row with counts
4. Click "Generate Invite" — modal opens with type/uses/expiry fields
5. Generate a B2C invite — success view shows code, copy works
6. Close modal — new invite appears in table
7. Click on invite row — detail panel expands with full info
8. Revoke an active invite — status changes to "revoked"
9. Admin nav — active route is highlighted, all links work
10. Mobile view — hamburger menu appears and functions
</verification>

<success_criteria>
- ADMN-01 satisfied: Super Admin can generate invite codes with configurable expiry and usage limits
- ADMN-02 satisfied: Super Admin can track invite code status (active/used/expired) with usage history
- Admin layout is functional with active route highlighting and mobile responsiveness
- Admin dashboard shows live platform stats from services
- All patterns reuse existing B2B components (DataTable, StatsRow, StatusBadge)
</success_criteria>

<output>
After completion, create `.planning/phases/05-platform-administration/05-01-SUMMARY.md`
</output>
