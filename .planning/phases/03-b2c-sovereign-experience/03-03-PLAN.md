---
phase: 03-b2c-sovereign-experience
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/app/(b2c)/journeys/page.tsx
  - src/app/(b2c)/journeys/[id]/page.tsx
  - src/components/b2c/journeys/JourneyCard.tsx
  - src/components/b2c/journeys/JourneyList.tsx
  - src/components/b2c/journeys/JourneyDetail.tsx
  - src/components/b2c/journeys/JourneyActions.tsx
  - src/components/b2c/journeys/InvisibleItineraryToggle.tsx
  - src/components/b2c/journeys/RefineJourneyModal.tsx
  - src/components/b2c/journeys/ConfirmJourneyFlow.tsx
  - src/lib/utils/narrative-generator.ts
autonomous: true

must_haves:
  truths:
    - "UHNI can view 3-5 AI-generated narrative journeys with emotional objective, strategic reasoning, risk summary, and discretion annotation"
    - "UHNI can confirm a journey with end-to-end state change and confirmation display"
    - "UHNI can refine a journey with modification UI and regeneration"
    - "UHNI can toggle invisible itinerary to hide journey from all other roles"
    - "UHNI can view journey detail page with full narrative and archive journey"
  artifacts:
    - path: "src/app/(b2c)/journeys/page.tsx"
      provides: "Journey list page with narrative cards"
      min_lines: 40
    - path: "src/app/(b2c)/journeys/[id]/page.tsx"
      provides: "Journey detail page with full narrative"
      min_lines: 50
    - path: "src/lib/utils/narrative-generator.ts"
      provides: "Mock AI narrative generation from intent profile"
      min_lines: 40
    - path: "src/components/b2c/journeys/ConfirmJourneyFlow.tsx"
      provides: "Confirm journey end-to-end flow"
      min_lines: 30
  key_links:
    - from: "src/app/(b2c)/journeys/page.tsx"
      to: "src/lib/utils/narrative-generator.ts"
      via: "generateNarrativeJourneys call"
      pattern: "generateNarrativeJourneys"
    - from: "src/components/b2c/journeys/ConfirmJourneyFlow.tsx"
      to: "src/lib/services/mock/journey.mock.ts"
      via: "updateJourney status change"
      pattern: "updateJourney.*APPROVED|status.*APPROVED"
    - from: "src/components/b2c/journeys/InvisibleItineraryToggle.tsx"
      to: "src/lib/services/mock/journey.mock.ts"
      via: "updateJourney isInvisible toggle"
      pattern: "isInvisible"
---

<objective>
Build the Journey Intelligence engine -- mock AI narrative generation, journey list with rich cards, journey detail page, and complete confirm/refine/archive/invisible-itinerary flows. Every CTA works end-to-end.

Purpose: Journeys are the core value proposition of Elan. The UHNI sees personalized narrative experiences generated from their emotional profile. This must feel like receiving a bespoke travel proposal from a luxury concierge, not browsing a catalog.
Output: Working /journeys page with generated narratives, /journeys/[id] detail page, confirm/refine/archive flows, invisible itinerary toggle.
</objective>

<execution_context>
@/Users/kavi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kavi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-b2c-sovereign-experience/03-RESEARCH.md
@.planning/phases/03-b2c-sovereign-experience/03-01-SUMMARY.md

@src/lib/types/entities.ts
@src/lib/types/validation.ts
@src/lib/services/mock/journey.mock.ts
@src/lib/services/interfaces/IJourneyService.ts
@src/app/(b2c)/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build mock narrative generator and Journey list page with rich cards</name>
  <files>
    src/lib/utils/narrative-generator.ts
    src/app/(b2c)/journeys/page.tsx
    src/components/b2c/journeys/JourneyCard.tsx
    src/components/b2c/journeys/JourneyList.tsx
  </files>
  <action>
    1. **narrative-generator.ts** (JRNY-01): Mock AI narrative generation:
       - `generateNarrativeJourneys(intentProfile: IntentProfile): Journey[]` -- generates 3-5 mock journeys
       - Use template-based approach: templates for each category (Travel, Wellness, Philanthropy, etc.)
       - Each generated journey includes:
         - `title`: evocative narrative title (e.g., "The Sardinian Coast: A Legacy of Silence")
         - `narrative`: 3-4 paragraph narrative (200+ words) written in luxury editorial voice
         - `emotionalObjective` (JRNY-02): sentence about what emotional need this serves
         - `strategicReasoning` (JRNY-03): why this journey aligns with their profile
         - `riskSummary` (JRNY-04): brief risk assessment in plain language
         - `discretionLevel` (JRNY-05): High/Medium/Standard with annotation
         - `category`: mapped from travel mode and priorities
       - Templates should vary based on intent profile's life stage, travel mode, and top emotional drivers
       - Include at least 8-10 templates to provide variety
       - Create journeys via the journey service (so they persist in localStorage)

    2. **JourneyCard.tsx**: Rich journey preview card:
       - Title (serif, large), category badge, discretion level badge
       - Emotional objective as subtitle text
       - Narrative excerpt (first 150 chars with ellipsis)
       - Risk indicator (color dot: green/amber/red)
       - Status badge (Draft/Approved/Archived)
       - Invisible itinerary indicator (lock icon if invisible)
       - Click navigates to /journeys/[id]
       - Framer Motion hover scale effect

    3. **JourneyList.tsx**: List/grid of journey cards:
       - Fetches journeys from service via useServices hook
       - Shows react-loading-skeleton while loading
       - Responsive: 1 column mobile, 2 columns tablet, 3 columns desktop
       - Empty state: "No journeys yet. Complete your Intent Profile to receive personalized recommendations." with CTA to /intent
       - If intent profile exists but no journeys: "Generate Journeys" button that calls generateNarrativeJourneys

    4. **Journeys page.tsx**:
       - Hero: "Your Journey Intelligence" with narrative subtitle
       - "Generate New Journeys" button (calls narrative generator, creates journeys via service)
       - JourneyList below hero
       - Filter tabs: All, Active, Archived (using Tabs component)
       - Framer Motion staggered entrance for journey cards

    DESIGN: Journey cards should look like editorial feature previews -- think travel magazine covers, not list items. Each card is a mini story.

    AVOID: Don't generate journeys on every page load -- only on explicit user action ("Generate Journeys" button). Don't show technical status values -- map to human-friendly labels.
  </action>
  <verify>
    `npm run build` succeeds. Navigate to /journeys:
    - If no intent profile: shows message to complete profile first
    - If intent profile exists: "Generate Journeys" button works
    - Generated journeys appear as rich cards with all fields
    - Cards are clickable and navigate to detail page
    - Filter tabs work (All/Active/Archived)
    - Loading skeleton shown during fetch
  </verify>
  <done>
    Journey list page shows 3-5 AI-generated narrative journeys (JRNY-01) with emotional objective (JRNY-02), strategic reasoning (JRNY-03), risk summary (JRNY-04), and discretion annotation (JRNY-05) per journey. Mock narrative generator creates rich, varied content based on intent profile. Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build Journey detail page with confirm, refine, archive, and invisible itinerary flows</name>
  <files>
    src/app/(b2c)/journeys/[id]/page.tsx
    src/components/b2c/journeys/JourneyDetail.tsx
    src/components/b2c/journeys/JourneyActions.tsx
    src/components/b2c/journeys/ConfirmJourneyFlow.tsx
    src/components/b2c/journeys/RefineJourneyModal.tsx
    src/components/b2c/journeys/InvisibleItineraryToggle.tsx
  </files>
  <action>
    1. **JourneyDetail.tsx** (JRNY-10): Full narrative view:
       - Full title, category, and status displayed prominently
       - Complete narrative text in editorial typography (serif, generous line-height)
       - Emotional objective section with visual accent (rose border-left)
       - Strategic reasoning section
       - Risk summary in a callout card
       - Discretion level badge with explanation text
       - Version info (version number, last modified date)
       - Framer Motion entrance animation

    2. **JourneyActions.tsx**: Action buttons bar for journey:
       - "Confirm Journey" button (primary, rose) -- only for DRAFT status
       - "Refine Journey" button (secondary, outlined) -- only for DRAFT status
       - "Archive" button (tertiary, text-only) -- for APPROVED or DRAFT
       - Layout: horizontal on desktop, stacked on mobile

    3. **ConfirmJourneyFlow.tsx** (JRNY-06): End-to-end confirm flow:
       - CTA click opens a confirmation dialog (use Modal component)
       - Dialog shows: "Confirm this journey?" with journey title and brief summary
       - "Confirm" button calls `services.journey.updateJourney(id, { status: JourneyStatus.APPROVED })`
       - On success: dismiss modal, show success state (checkmark animation, "Journey Confirmed" message)
       - Update the page to reflect new APPROVED status
       - Log audit event

    4. **RefineJourneyModal.tsx** (JRNY-07): End-to-end refine flow:
       - CTA click opens a refinement modal/panel
       - Shows current narrative in editable form (textarea with rich formatting hints)
       - Allow modifying: title, narrative text, and emotional objective
       - "Regenerate" option: calls narrative generator for a single journey replacement
       - "Save Refinement" creates a new journey version via `services.journey.createJourneyVersion()`
       - Updates journey in list with new version
       - Dismisses modal, shows updated journey

    5. **InvisibleItineraryToggle.tsx** (JRNY-08): Toggle component:
       - Switch/toggle component that controls `journey.isInvisible`
       - When ON: shows lock icon + "This journey is invisible to all other roles"
       - When OFF: shows unlock icon + "This journey is visible per your privacy settings"
       - Toggling calls `services.journey.updateJourney(id, { isInvisible: !current })`
       - Subtle animation on toggle (Framer Motion)
       - Placed prominently in journey detail, near the top

    6. **Journey [id] page.tsx**:
       - Fetch journey by ID from URL params using journey service
       - Show JourneyDetail, InvisibleItineraryToggle, and JourneyActions
       - 404 handling: show "Journey not found" if ID doesn't match
       - Back link to /journeys
       - Archive flow (JRNY-09): Archive button calls `services.journey.updateJourney(id, { status: JourneyStatus.ARCHIVED })`, redirects to /journeys with toast "Journey archived"

    EVERY CTA has end-to-end flow. No dead buttons.

    AVOID: Don't use browser confirm() -- use the Modal component. Don't allow editing approved journeys (only refine creates a new version). Don't forget loading states during service calls.
  </action>
  <verify>
    `npm run build` succeeds. Navigate to /journeys/[id]:
    - Full narrative displayed in editorial layout
    - "Confirm Journey" opens modal, confirms, updates status to APPROVED
    - "Refine Journey" opens editing modal, saves new version
    - Invisible itinerary toggle works and persists
    - "Archive" changes status and redirects
    - Back link works
    - No dead buttons, every CTA completes its flow
  </verify>
  <done>
    Journey detail page shows full narrative (JRNY-10). Confirm journey end-to-end flow works (JRNY-06). Refine journey with modification UI and regeneration works (JRNY-07). Invisible itinerary toggle hides journey from other roles (JRNY-08). Archive flow works (JRNY-09). All CTAs have complete end-to-end flows. Build passes.
  </done>
</task>

</tasks>

<verification>
- `npm run build` completes without errors
- /journeys route renders journey list with rich narrative cards
- Mock narrative generator produces varied, believable content
- /journeys/[id] shows full detail with all action buttons working
- Confirm flow: CTA -> modal -> state change -> confirmation display
- Refine flow: CTA -> modification UI -> new version -> updated display
- Invisible itinerary: toggle -> service update -> visual change
- Archive: CTA -> state change -> redirect to list
- All JRNY requirements (01-10) addressed
</verification>

<success_criteria>
1. UHNI can view 3-5 AI-generated narrative journeys with emotional objective, strategic reasoning, risk summary, and discretion annotation (Success Criteria #4)
2. UHNI can confirm journey end-to-end (Success Criteria #5)
3. UHNI can refine journey end-to-end (Success Criteria #6)
4. UHNI can toggle invisible itinerary (Success Criteria #7)
5. UHNI can view journey detail and archive journey (Success Criteria #8)
</success_criteria>

<output>
After completion, create `.planning/phases/03-b2c-sovereign-experience/03-03-SUMMARY.md`
</output>
