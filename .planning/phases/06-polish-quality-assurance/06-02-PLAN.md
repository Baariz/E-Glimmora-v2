---
phase: 06-polish-quality-assurance
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - tailwind.config.ts
  - next.config.ts
  - src/app/globals.css
  - src/app/layout.tsx
  - src/app/fonts.ts
  - src/app/(b2c)/layout.tsx
  - src/app/(b2b)/layout.tsx
  - src/app/(admin)/layout.tsx
  - src/app/(marketing)/layout.tsx
  - src/components/marketing/MarketingNav.tsx
  - src/components/marketing/MarketingFooter.tsx
  - src/components/shared/Button/Button.tsx
autonomous: true

must_haves:
  truths:
    - "Mobile layouts render correctly at 375px (iPhone SE) and 390px (iPhone 14) viewports"
    - "Desktop layouts use full viewport with luxury spacing at 1440px and above"
    - "B2C top nav collapses to hamburger menu on mobile with touch-friendly targets"
    - "B2B sidebar collapses or transforms to bottom nav / drawer on mobile"
    - "Admin nav hamburger menu works on mobile with all links accessible"
    - "Container queries enable card components to adapt within their parent container"
    - "Touch targets are minimum 44x44px on all interactive elements across mobile"
    - "Images use Next.js Image component with responsive sizes prop"
    - "Font loading uses next/font with swap display strategy"
    - "Production build Lighthouse performance score targets 90+"
  artifacts:
    - path: "tailwind.config.ts"
      provides: "Container query plugin and responsive design tokens"
      contains: "@tailwindcss/container-queries"
    - path: "next.config.ts"
      provides: "Optimized Next.js config with image domains and compression"
      contains: "images"
    - path: "src/app/globals.css"
      provides: "Container query utilities and mobile-first base styles"
      contains: "@container"
  key_links:
    - from: "src/app/(b2c)/layout.tsx"
      to: "tailwind.config.ts"
      via: "Responsive breakpoints and container query classes"
      pattern: "md:|lg:|@container|hidden md:flex"
    - from: "src/app/(b2b)/layout.tsx"
      to: "tailwind.config.ts"
      via: "Responsive sidebar collapse"
      pattern: "md:|lg:|hidden|block"
---

<objective>
Refine responsive design across all route groups for mobile/desktop excellence and optimize performance for Lighthouse 90+ scores through Next.js built-in features.

Purpose: UHNI access the platform from any device. Both mobile and desktop must deliver the full luxury experience with touch-optimized interactions and performant loading.

Output: Mobile-optimized layouts for all 4 route groups, container query support, touch target compliance, Next.js Image/Font optimization, and production-ready performance configuration.
</objective>

<execution_context>
@/Users/kavi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kavi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-polish-quality-assurance/06-RESEARCH.md

# Layout files to make responsive
@src/app/(b2c)/layout.tsx
@src/app/(b2b)/layout.tsx
@src/app/(admin)/layout.tsx
@src/app/(marketing)/layout.tsx
@src/components/marketing/MarketingNav.tsx
@src/components/marketing/MarketingFooter.tsx

# Config files
@tailwind.config.ts
@next.config.ts
@src/app/globals.css
@src/app/layout.tsx
@src/app/fonts.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Container queries, responsive config, and performance optimization</name>
  <files>
    tailwind.config.ts
    next.config.ts
    src/app/globals.css
    src/app/layout.tsx
    src/app/fonts.ts
  </files>
  <action>
  1. Install `@tailwindcss/container-queries` plugin:
     ```bash
     npm install -D @tailwindcss/container-queries
     ```

  2. Update `tailwind.config.ts`:
     - Add `require('@tailwindcss/container-queries')` to plugins array
     - Verify responsive breakpoints are correct: sm:640px, md:768px, lg:1024px, xl:1280px, 2xl:1536px (Tailwind defaults are fine)
     - Add `screens` to theme.extend if custom breakpoints needed for luxury spacing

  3. Update `next.config.ts` for performance:
     - Add `compress: true` (gzip compression)
     - Update `images` config: add `formats: ['image/avif', 'image/webp']` for modern format support
     - Add `deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840]` to images config
     - Add `imageSizes: [16, 32, 48, 64, 96, 128, 256, 384]` to images config
     - Keep `reactStrictMode: true`

  4. Update `src/app/globals.css`:
     - Add `@layer utilities` block with container query utility classes:
       ```css
       @layer utilities {
         .container-query { container-type: inline-size; }
         .container-query-name { container-type: inline-size; }
       }
       ```
     - Add base responsive styles:
       ```css
       @layer base {
         html { scroll-behavior: smooth; }
         @media (prefers-reduced-motion: reduce) {
           html { scroll-behavior: auto; }
           *, *::before, *::after { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; scroll-behavior: auto !important; }
         }
       }
       ```
     - Add touch target utility: `.touch-target { min-height: 44px; min-width: 44px; }`

  5. Review `src/app/fonts.ts`:
     - Verify font loading uses `display: 'swap'` for zero CLS (check existing implementation)
     - Ensure CSS variable approach is correct for `--font-miller-display` and `--font-avenir-lt`
     - Do NOT change fallback fonts (Georgia/system-ui) — licensed fonts not yet provided

  6. Review `src/app/layout.tsx`:
     - Ensure `<html>` tag has font CSS variables applied
     - Add `<meta name="viewport" content="width=device-width, initial-scale=1" />` if not already present (Next.js may handle this automatically)
  </action>
  <verify>
  - `npx tsc --noEmit` passes
  - `npm run build` succeeds
  - Container query plugin loaded (check Tailwind output for @container support)
  - globals.css includes prefers-reduced-motion media query
  </verify>
  <done>
  Tailwind container queries plugin installed and configured. Next.js image optimization enhanced with AVIF/WebP support. Global CSS includes reduced-motion overrides and touch target utilities. Font loading verified with swap display strategy.
  </done>
</task>

<task type="auto">
  <name>Task 2: Mobile-responsive layouts for all 4 route groups</name>
  <files>
    src/app/(b2c)/layout.tsx
    src/app/(b2b)/layout.tsx
    src/app/(admin)/layout.tsx
    src/app/(marketing)/layout.tsx
    src/components/marketing/MarketingNav.tsx
    src/components/marketing/MarketingFooter.tsx
  </files>
  <action>
  1. Enhance `src/app/(b2c)/layout.tsx` B2C navigation for mobile:
     - Read the full file first
     - Add mobile hamburger menu toggle (useState for open/close)
     - Desktop: keep current horizontal nav links (`hidden md:flex`)
     - Mobile: hamburger icon visible on small screens (`md:hidden`), opens full-width dropdown with nav links
     - Ensure nav links have `min-h-[44px]` padding for touch targets on mobile
     - Mobile nav should use `AnimatePresence` + `motion.div` for smooth open/close (import from framer-motion)
     - User avatar and context switcher: stack vertically on mobile menu
     - Main content: reduce horizontal padding on mobile (`px-4 md:px-6`), reduce vertical padding (`py-4 md:py-8`)

  2. Enhance `src/app/(b2b)/layout.tsx` B2B sidebar for mobile:
     - Read the full file first
     - Desktop (md+): keep current fixed sidebar layout
     - Mobile (<md): sidebar becomes a slide-out drawer triggered by hamburger icon
     - Add a mobile header bar with hamburger toggle and brand name
     - Add overlay backdrop when drawer is open
     - Drawer slides in from left with `motion.aside` transform
     - Remove `fixed` positioning on mobile, use absolute/fixed drawer instead
     - Main content: remove `ml-64` on mobile, apply only on `md:ml-64`
     - Close drawer on link click (add onClick handler)
     - Close drawer on overlay click
     - Reduce content padding on mobile (`p-4 md:p-8`)

  3. Verify `src/app/(admin)/layout.tsx` admin nav mobile:
     - Read the full file — the admin layout already has a mobile hamburger menu
     - Verify touch targets are 44px minimum on mobile menu items
     - Add `min-h-[44px]` to mobile menu links if not present
     - Verify mobile menu closes on link click

  4. Verify `src/components/marketing/MarketingNav.tsx` mobile:
     - Read the existing nav
     - Marketing nav already has mobile hamburger (full-screen overlay from Phase 2 decision)
     - Verify touch targets, ensure links have adequate padding
     - If the mobile menu doesn't exist, add it with full-screen overlay matching luxury aesthetic

  5. Verify `src/components/marketing/MarketingFooter.tsx` responsive:
     - Read the existing footer
     - Ensure footer columns stack on mobile (grid cols 1 on mobile, 3-4 on desktop)
     - Verify text sizing is readable on mobile (min 14px / text-sm)
  </action>
  <verify>
  - `npm run build` succeeds with no errors
  - B2C: at 375px width, nav shows hamburger, links are in dropdown, touch targets >= 44px
  - B2B: at 375px width, sidebar is hidden, hamburger opens drawer, content fills full width
  - Admin: at 375px width, hamburger menu opens with all links, touch targets >= 44px
  - Marketing: at 375px width, nav has mobile menu, footer stacks vertically
  - All layouts at 1440px: luxury spacing, full nav visible, no visual regressions
  </verify>
  <done>
  B2C nav has mobile hamburger menu with animated dropdown. B2B sidebar collapses to slide-out drawer on mobile with overlay. Admin mobile menu verified with touch targets. Marketing nav and footer responsive at all breakpoints. All interactive elements have minimum 44x44px touch targets on mobile.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` — no type errors
2. `npm run build` — production build succeeds
3. Responsive check at 375px: All 4 layouts functional with touch-friendly navigation
4. Responsive check at 1440px: Luxury spacing, full navigation, no regressions
5. Container queries available in Tailwind classes (@container syntax usable)
6. Next.js Image config supports AVIF/WebP formats
7. Global CSS includes prefers-reduced-motion override for all animations
</verification>

<success_criteria>
- Mobile layouts render correctly at 375px and 390px viewports across all 4 route groups
- Desktop layouts maintain luxury spacing at 1440px+
- B2C, B2B, Admin navigation is fully functional on mobile with 44px touch targets
- Container query Tailwind plugin installed and configured
- Next.js Image/Font optimization configured for production
- Global reduced-motion CSS override disables all CSS animations/transitions
- Production build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/06-polish-quality-assurance/06-02-SUMMARY.md`
</output>
