---
phase: 01-foundation-design-system
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/styles/variants/index.ts
  - src/styles/variants/page-transitions.ts
  - src/styles/variants/scroll-reveal.ts
  - src/styles/variants/micro-interactions.ts
  - src/components/providers/PageTransition.tsx
  - src/components/shared/ScrollReveal/ScrollReveal.tsx
  - src/components/shared/ScrollReveal/index.ts
  - src/components/shared/Parallax/Parallax.tsx
  - src/components/shared/Parallax/index.ts
  - src/lib/hooks/useReducedMotion.ts
  - src/app/(marketing)/layout.tsx
  - src/app/(marketing)/page.tsx
  - src/app/(b2c)/layout.tsx
  - src/app/(b2c)/briefing/page.tsx
  - src/app/(b2b)/layout.tsx
  - src/app/(b2b)/portfolio/page.tsx
  - src/app/(admin)/layout.tsx
  - src/app/(admin)/dashboard/page.tsx
autonomous: true

must_haves:
  truths:
    - "Page transitions animate (fade + slide) when navigating between routes within the same route group"
    - "ScrollReveal component fades in elements as they scroll into viewport"
    - "Parallax component moves children at a different speed than scroll"
    - "Reduced motion preference is respected — animations are disabled when prefers-reduced-motion is set"
    - "Marketing layout renders with minimal editorial chrome (no nav/sidebar)"
    - "B2C layout renders with website-style navigation (NOT dashboard sidebar)"
    - "B2B layout renders with premium sidebar navigation (dashboard pattern)"
    - "Admin layout renders with functional top navigation"
    - "PageTransition wraps children in B2C, B2B, and Admin layouts (not marketing — it uses editorial scroll animations)"
    - "Each route group has its own layout.tsx and a placeholder page at a sub-route (except marketing which owns /)"
    - "Route groups do NOT affect URL structure (e.g., /briefing not /b2c/briefing)"
    - "Font CSS variables from Plan 01-01 are present on html element — serif headings and sans body text render in each layout"
  artifacts:
    - path: "src/styles/variants/page-transitions.ts"
      provides: "Framer Motion page transition variants"
      exports: ["fadeSlide", "fadeScale", "slideFromRight"]
    - path: "src/components/providers/PageTransition.tsx"
      provides: "AnimatePresence wrapper with pathname key"
      contains: "usePathname, AnimatePresence, motion"
    - path: "src/components/shared/ScrollReveal/ScrollReveal.tsx"
      provides: "Scroll-triggered fade-in component"
      contains: "useInView"
    - path: "src/components/shared/Parallax/Parallax.tsx"
      provides: "Parallax scroll effect component"
      contains: "useScroll, useTransform"
    - path: "src/lib/hooks/useReducedMotion.ts"
      provides: "Reduced motion detection hook"
      exports: ["useReducedMotion"]
    - path: "src/app/(marketing)/layout.tsx"
      provides: "Marketing domain layout"
      contains: "editorial layout"
    - path: "src/app/(b2c)/layout.tsx"
      provides: "B2C domain layout"
      contains: "website-style nav"
    - path: "src/app/(b2b)/layout.tsx"
      provides: "B2B domain layout"
      contains: "sidebar"
    - path: "src/app/(admin)/layout.tsx"
      provides: "Admin domain layout"
      contains: "admin nav"
  key_links:
    - from: "src/app/(b2c)/layout.tsx"
      to: "src/components/providers/PageTransition.tsx"
      via: "import { PageTransition }"
      pattern: "PageTransition"
    - from: "src/app/(b2b)/layout.tsx"
      to: "src/components/providers/PageTransition.tsx"
      via: "import { PageTransition }"
      pattern: "PageTransition"
    - from: "src/app/(admin)/layout.tsx"
      to: "src/components/providers/PageTransition.tsx"
      via: "import { PageTransition }"
      pattern: "PageTransition"
    - from: "src/components/providers/PageTransition.tsx"
      to: "src/styles/variants/page-transitions.ts"
      via: "import { fadeSlide }"
      pattern: "import.*variants"
    - from: "src/components/shared/ScrollReveal/ScrollReveal.tsx"
      to: "src/lib/hooks/useReducedMotion.ts"
      via: "import { useReducedMotion }"
      pattern: "useReducedMotion"
---

<objective>
Build the Framer Motion animation system (page transitions, scroll-triggered animations, parallax, reduced motion) and establish the four route group layouts with domain-specific chrome.

Purpose: Cinematic motion design is core to the luxury feel. Route group layouts define the structural DNA of each domain — marketing is editorial, B2C is narrative website, B2B is premium dashboard, admin is functional. These architectural decisions affect every page built in later phases.
Output: Complete animation toolkit (PageTransition, ScrollReveal, Parallax, motion variants) and 4 route group layouts with placeholder pages.
</objective>

<execution_context>
@/Users/kavi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kavi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-design-system/01-RESEARCH.md (Pattern 5: Framer Motion Page Transitions, Pattern 6: Route Group Layouts)
@.planning/phases/01-foundation-design-system/01-01-SUMMARY.md (for project structure, Tailwind config)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Framer Motion animation system with variants, utilities, and reduced motion</name>
  <files>
    src/styles/variants/index.ts
    src/styles/variants/page-transitions.ts
    src/styles/variants/scroll-reveal.ts
    src/styles/variants/micro-interactions.ts
    src/components/providers/PageTransition.tsx
    src/components/shared/ScrollReveal/ScrollReveal.tsx
    src/components/shared/ScrollReveal/index.ts
    src/components/shared/Parallax/Parallax.tsx
    src/components/shared/Parallax/index.ts
    src/lib/hooks/useReducedMotion.ts
  </files>
  <action>
    1. Create `src/lib/hooks/useReducedMotion.ts`:
       - 'use client' directive
       - Hook that checks `window.matchMedia('(prefers-reduced-motion: reduce)')`
       - Returns boolean `prefersReducedMotion`
       - Listens for changes and updates reactively
       - SSR-safe: defaults to false on server

    2. Create `src/styles/variants/page-transitions.ts`:
       - Export reusable Framer Motion variant objects:
         - `fadeSlide`: initial(opacity:0, y:20) → animate(opacity:1, y:0) → exit(opacity:0, y:-20), duration 0.3s easeInOut
         - `fadeScale`: initial(opacity:0, scale:0.96) → animate(opacity:1, scale:1) → exit(opacity:0, scale:0.96), duration 0.25s
         - `slideFromRight`: initial(opacity:0, x:30) → animate(opacity:1, x:0) → exit(opacity:0, x:-30), duration 0.3s
         - `slideFromLeft`: initial(opacity:0, x:-30) → animate(opacity:1, x:0) → exit(opacity:0, x:30), duration 0.3s
       - Each variant is an object with { initial, animate, exit, transition } that can be spread onto motion.div

    3. Create `src/styles/variants/scroll-reveal.ts`:
       - Export scroll reveal variants:
         - `fadeUp`: initial(opacity:0, y:40) → visible(opacity:1, y:0), duration 0.6s easeOut
         - `fadeIn`: initial(opacity:0) → visible(opacity:1), duration 0.5s
         - `scaleIn`: initial(opacity:0, scale:0.9) → visible(opacity:1, scale:1), duration 0.5s
         - `staggerChildren`: parent variant with staggerChildren:0.1 for sequential child reveals

    4. Create `src/styles/variants/micro-interactions.ts`:
       - Export micro-interaction variants:
         - `buttonTap`: { scale: 0.97 } (for whileTap)
         - `buttonHover`: { scale: 1.02, transition: { duration: 0.2 } } (for whileHover)
         - `cardHover`: { y: -4, shadow: 'lg', transition: { duration: 0.2 } }
         - `pulseOnce`: animate(scale: [1, 1.05, 1]), duration 0.3s
         - `shimmer`: animate background gradient position shift

    5. Create `src/styles/variants/index.ts` barrel export.

    6. Create `src/components/providers/PageTransition.tsx`:
       - 'use client' directive
       - Import AnimatePresence, motion from framer-motion
       - Import usePathname from next/navigation
       - Import useReducedMotion hook
       - Import fadeSlide variant (default)
       - Props: children, variant? (to override default animation)
       - Wrap children in AnimatePresence mode="wait" initial={false}
       - Inner motion.div keyed by pathname
       - If prefersReducedMotion, skip animation (instant transition)
       - CRITICAL: key={pathname} on the motion.div — without this, exit animations break

    7. Create `src/components/shared/ScrollReveal/ScrollReveal.tsx`:
       - 'use client' directive
       - Import motion, useInView from framer-motion
       - Import useReducedMotion
       - Props: children, variant? (default: fadeUp), delay? (number), once? (boolean, default: true), amount? (number, default: 0.3)
       - Use useRef + useInView with { once, amount } options
       - Animate when isInView becomes true
       - If reduced motion preferred, render children without animation
       - Create index.ts barrel

    8. Create `src/components/shared/Parallax/Parallax.tsx`:
       - 'use client' directive
       - Import motion, useScroll, useTransform from framer-motion
       - Import useReducedMotion
       - Props: children, speed? (number, default: 0.5), className?
       - Use useRef + useScroll with target and offset
       - Transform scrollYProgress to y position based on speed
       - If reduced motion preferred, render children without parallax
       - Create index.ts barrel
  </action>
  <verify>
    Run `pnpm tsc --noEmit` — all animation files compile.
    Verify PageTransition, ScrollReveal, Parallax are importable.
    Verify all variant objects have correct Framer Motion shape (initial, animate, exit).
  </verify>
  <done>
    Animation variant library created with 4 page transition styles, 4 scroll reveal styles, and 5 micro-interaction presets. PageTransition wraps route children with AnimatePresence. ScrollReveal triggers on viewport entry. Parallax transforms scroll position. All respect prefers-reduced-motion.
  </done>
</task>

<task type="auto">
  <name>Task 2: Establish four route group layouts with domain-specific chrome</name>
  <files>
    src/app/(marketing)/layout.tsx
    src/app/(marketing)/page.tsx
    src/app/(b2c)/layout.tsx
    src/app/(b2c)/briefing/page.tsx
    src/app/(b2b)/layout.tsx
    src/app/(b2b)/portfolio/page.tsx
    src/app/(admin)/layout.tsx
    src/app/(admin)/dashboard/page.tsx
  </files>
  <action>
    1. Create `src/app/(marketing)/layout.tsx`:
       - Server Component (NO 'use client')
       - Minimal editorial layout: full-width, no persistent navigation
       - Background: bg-white (clean canvas for editorial content)
       - Main content area: no max-width constraint (full editorial freedom)
       - This layout provides NO navigation bar — marketing pages control their own nav per section
       - Metadata: title template "%s | Élan Glimmora"

    2. Create `src/app/(marketing)/page.tsx`:
       - Placeholder homepage that will become the editorial scroll story
       - For now: centered hero section with font-serif heading "Élan Glimmora" in text-rose-900
       - Subheading in font-sans text-sand-600: "Sovereign Lifestyle Intelligence"
       - Display the 5 color palette swatches
       - This is a development placeholder — Phase 2 replaces it entirely
       - Mark with comment: // TODO: Phase 2 replaces this with editorial homepage

    3. Create `src/app/(b2c)/layout.tsx`:
       - Must feel like a LUXURY WEBSITE, NOT a dashboard
       - Background: bg-sand-50 (warm, inviting)
       - IMPORTANT: B2C navigation is website-style (horizontal top nav, NOT sidebar):
         - Sticky top navigation bar
         - Logo/brand mark on left
         - Navigation links: Briefing, Intent, Journeys, Intelligence, Vault, Privacy
         - User menu on right (placeholder)
       - Build the nav as a basic placeholder component INLINE in this file (or a simple component):
         - <nav> with flex, justify-between, items-center
         - Font-sans, text-sm, text-rose-800
         - Hover states on links
       - Main content area: max-w-7xl mx-auto px-6 py-8 (generous luxury spacing)
       - Wrap children in PageTransition provider for animated route changes
       - B2C must NOT look like B2B — no sidebar, no data-dense layouts

    4. Create `src/app/(b2c)/briefing/page.tsx` (URL: `/briefing`):
       - Placeholder page for B2C briefing (will become Sovereign Briefing in Phase 3)
       - Hero area with font-serif heading "Your Sovereign Briefing"
       - 3-column grid with Card components showing placeholder data:
         - Emotional Phase: "Renewal" (card with teal accent)
         - Upcoming Journey: "Mediterranean Solitude" (card with rose accent)
         - Risk Status: "Low Exposure" (card with olive accent)
       - Uses Card component from shared components (import from @/components/shared)
       - Mark: // TODO: Phase 3 replaces with full Sovereign Briefing

    5. Create `src/app/(b2b)/layout.tsx`:
       - Must feel like a PREMIUM DASHBOARD (sidebar navigation, higher data density)
       - Background: bg-slate-50 (corporate, professional)
       - Sidebar navigation (left side, fixed width 260px):
         - Brand mark at top
         - Navigation sections: Portfolio, Clients, Journeys, Risk, Access, Vault, Revenue
         - Each nav item has an icon placeholder (use div with text for now, lucide icons later)
         - Active state: bg-rose-50 text-rose-900 border-l-2 border-rose-500
         - Inactive: text-slate-600 hover:bg-slate-100
       - Build sidebar as inline component for now
       - Main content area: flex-1 p-8 overflow-auto
       - Header bar above content with breadcrumb area and user menu placeholder
       - Wrap children in PageTransition provider for animated route changes

    6. Create `src/app/(b2b)/portfolio/page.tsx` (URL: `/portfolio`):
       - Placeholder dashboard page (will become Portfolio Dashboard in Phase 4)
       - Heading: "Portfolio Dashboard" in font-serif
       - Stats row: 4 cards with placeholder metrics (Total Clients, Active Journeys, Risk Alerts, Revenue)
       - Data table placeholder area
       - Mark: // TODO: Phase 4 replaces with full Portfolio Dashboard

    7. Create `src/app/(admin)/layout.tsx`:
       - Functional admin panel layout (clean, operational, not luxury)
       - Background: bg-gray-50
       - Top navigation bar:
         - "Élan Admin" brand mark
         - Nav links: Invites, Members, Institutions, Audit, System, Revenue
         - User/logout on right
       - Main content area: max-w-7xl mx-auto px-6 py-6
       - Wrap children in PageTransition provider for animated route changes

    8. Create `src/app/(admin)/dashboard/page.tsx` (URL: `/dashboard`):
       - Placeholder admin dashboard
       - Heading: "Platform Administration"
       - Quick stats: Invite Codes, Active Members, Institutions, System Health
       - Mark: // TODO: Phase 5 replaces with full Admin Dashboard

    IMPORTANT — URL path ownership (route groups do NOT affect URLs):
    - `(marketing)/page.tsx` → `/` (marketing owns root)
    - `(b2c)/briefing/page.tsx` → `/briefing`
    - `(b2b)/portfolio/page.tsx` → `/portfolio`
    - `(admin)/dashboard/page.tsx` → `/dashboard`
    - Do NOT create `page.tsx` at the route group root for B2C, B2B, or Admin — only sub-route pages to avoid conflicts with marketing's `/`.
  </action>
  <verify>
    Run `pnpm dev` and verify these URLs work:
    - localhost:3000/ → Marketing layout (editorial, no nav)
    - localhost:3000/briefing → B2C layout (website nav, sand-50 background)
    - localhost:3000/portfolio → B2B layout (sidebar, slate-50 background)
    - localhost:3000/dashboard → Admin layout (top nav, gray-50 background)
    Run `pnpm build` — production build succeeds with all route groups.
    Visually confirm: B2C does NOT have a sidebar. B2B DOES have a sidebar. Marketing has NO persistent nav.
    Inspect html element in each route group — font CSS variables from Plan 01-01 are present and applied. Verify serif headings (font-serif) and sans body text (font-sans) render correctly in each layout.
  </verify>
  <done>
    Four route group layouts established with distinct visual identities. Marketing: editorial (minimal chrome). B2C: website-style (top nav, warm background). B2B: dashboard (sidebar, professional). Admin: operational (top nav, gray). PageTransition applied to B2C, B2B, and Admin layouts. Marketing skips PageTransition (uses its own scroll-based editorial animations). Each has placeholder page at a distinct sub-route with domain-appropriate content. Route groups verified not to affect URL structure. Font CSS variables confirmed present in all layouts.
  </done>
</task>

</tasks>

<verification>
1. `pnpm dev` starts without errors
2. `pnpm build` completes without errors
3. All 4 route groups accessible at their respective URLs
4. PageTransition animates when navigating between B2C pages (add a temporary second B2C page to test)
5. Marketing layout: full-width, no navigation
6. B2C layout: top navigation bar, website feel, sand-50 background
7. B2B layout: sidebar navigation, dashboard feel, slate-50 background
8. Admin layout: top navigation, operational feel, gray-50 background
9. ScrollReveal component fades in content on scroll
10. Reduced motion users get instant transitions (no animation)
</verification>

<success_criteria>
- Framer Motion system operational: page transitions, scroll reveal, parallax
- 4+ page transition variants, 4 scroll reveal variants, 5 micro-interaction presets
- Reduced motion respected across all animation utilities
- Marketing layout is editorial (no persistent nav)
- B2C layout is website-style (top nav, NOT dashboard)
- B2B layout is premium dashboard (sidebar nav)
- Admin layout is functional operations panel
- All layouts accessible via correct URLs
- Production build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-design-system/01-03-SUMMARY.md`
</output>
