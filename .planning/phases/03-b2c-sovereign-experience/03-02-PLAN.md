---
phase: 03-b2c-sovereign-experience
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/app/(b2c)/intent/page.tsx
  - src/app/(b2c)/intent/wizard/page.tsx
  - src/components/b2c/wizards/IntentWizard.tsx
  - src/components/b2c/wizards/steps/LifePhaseStep.tsx
  - src/components/b2c/wizards/steps/EmotionalOutcomeStep.tsx
  - src/components/b2c/wizards/steps/TravelModeStep.tsx
  - src/components/b2c/wizards/steps/PrioritiesStep.tsx
  - src/components/b2c/wizards/steps/DiscretionStep.tsx
  - src/lib/hooks/useWizard.ts
  - src/lib/validation/intent-schemas.ts
  - src/components/b2c/intent/IntentProfileView.tsx
  - src/components/b2c/intent/AlignmentBaseline.tsx
  - src/components/b2c/intent/EmotionalDNACard.tsx
autonomous: true

must_haves:
  truths:
    - "UHNI can complete 5-step intake wizard from life phase to discretion preferences"
    - "Wizard generates Emotional Travel DNA and creates intent profile"
    - "UHNI can view Intent Profile with alignment baseline score"
    - "UHNI can edit and regenerate intent profile"
  artifacts:
    - path: "src/components/b2c/wizards/IntentWizard.tsx"
      provides: "Multi-step wizard orchestrator with step navigation"
      min_lines: 60
    - path: "src/lib/validation/intent-schemas.ts"
      provides: "Per-step Zod validation schemas"
      min_lines: 40
    - path: "src/components/b2c/intent/IntentProfileView.tsx"
      provides: "Intent profile display with alignment baseline"
      min_lines: 50
    - path: "src/lib/hooks/useWizard.ts"
      provides: "Reusable multi-step wizard navigation hook"
      min_lines: 30
  key_links:
    - from: "src/components/b2c/wizards/IntentWizard.tsx"
      to: "src/lib/validation/intent-schemas.ts"
      via: "zodResolver per step"
      pattern: "zodResolver|Step\\dSchema"
    - from: "src/components/b2c/wizards/IntentWizard.tsx"
      to: "src/lib/services/mock/intent.mock.ts"
      via: "useServices().intent.createIntentProfile"
      pattern: "createIntentProfile"
    - from: "src/components/b2c/intent/IntentProfileView.tsx"
      to: "src/lib/services/mock/intent.mock.ts"
      via: "useServices().intent.getIntentProfile"
      pattern: "getIntentProfile|calculateAlignmentBaseline"
---

<objective>
Build the Intent Intelligence module -- a 5-step intake wizard that captures the UHNI's emotional landscape and generates an Emotional Travel DNA profile. Includes the Intent Profile view page with alignment baseline visualization and edit/regenerate flows.

Purpose: This is the UHNI's self-discovery process -- the emotional foundation that drives all journey recommendations. The wizard must feel like a luxury consultation, not a SaaS onboarding form.
Output: Working /intent page with profile view, /intent/wizard with 5-step wizard, reusable useWizard hook, per-step Zod schemas.
</objective>

<execution_context>
@/Users/kavi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kavi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-b2c-sovereign-experience/03-RESEARCH.md
@.planning/phases/03-b2c-sovereign-experience/03-01-SUMMARY.md

@src/lib/types/entities.ts
@src/lib/types/validation.ts
@src/lib/services/mock/intent.mock.ts
@src/lib/services/interfaces/IIntentService.ts
@src/app/(b2c)/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build reusable wizard hook, per-step schemas, and 5-step Intent Wizard</name>
  <files>
    src/lib/hooks/useWizard.ts
    src/lib/validation/intent-schemas.ts
    src/app/(b2c)/intent/wizard/page.tsx
    src/components/b2c/wizards/IntentWizard.tsx
    src/components/b2c/wizards/steps/LifePhaseStep.tsx
    src/components/b2c/wizards/steps/EmotionalOutcomeStep.tsx
    src/components/b2c/wizards/steps/TravelModeStep.tsx
    src/components/b2c/wizards/steps/PrioritiesStep.tsx
    src/components/b2c/wizards/steps/DiscretionStep.tsx
  </files>
  <action>
    1. **useWizard.ts** -- Reusable multi-step wizard navigation hook:
       - Tracks currentStep, totalSteps, formData (accumulated across steps)
       - `next(stepData)`: merge step data into formData, advance step
       - `back()`: go to previous step
       - `goToStep(n)`: jump to specific step (for editing)
       - `isFirstStep`, `isLastStep` computed booleans
       - Persist formData to localStorage under a key (e.g., `wizard_intent`) so progress survives refresh (per research pitfall #1)
       - Restore from localStorage on mount

    2. **intent-schemas.ts** -- Per-step Zod validation schemas:
       - `Step1Schema` (Life Phase): `lifeStage` enum (Building, Preserving, Transitioning, Legacy Planning)
       - `Step2Schema` (Emotional Outcome): `emotionalDrivers` object with 5 sliders (security, adventure, legacy, recognition, autonomy) each 0-100
       - `Step3Schema` (Travel Mode): `travelMode` enum (Luxury, Adventure, Wellness, Cultural, Exclusive Access)
       - `Step4Schema` (Priorities): `priorities` array of strings (min 1, max 5 selections from predefined list), `values` array of strings
       - `Step5Schema` (Discretion): `discretionPreference` enum (High, Medium, Standard), plus `riskTolerance` enum
       - `IntentProfileMasterSchema`: merge of all 5 step schemas for final validation

    3. **IntentWizard.tsx** -- Orchestrator component:
       - Uses useWizard hook with totalSteps=5
       - Uses React Hook Form with `zodResolver(currentStepSchema)`
       - On each step submit: validate with step schema, call `wizard.next(data)`
       - On submit of step 5 ("Generate DNA" button click): collect `wizard.formData` which contains all merged step data, validate the complete object with `IntentProfileMasterSchema.parse(wizard.formData)`, then get the current user via `useAuth()` and call `const profile = await services.intent.createIntentProfile(currentUser.id, wizard.formData)`. Wrap in try/catch: set `isSubmitting` state to true before the call, on success clear localStorage wizard key and call `router.push('/intent')` to redirect, on error set an error state and display a toast/inline error ("Failed to generate your profile. Please try again."). Do NOT proceed to redirect if the service call fails.
       - Shows step indicator (1 of 5) with luxury styling -- thin rose line with numbered dots
       - Animates step transitions with Framer Motion (slide left/right with opacity)
       - Back button on steps 2-5, "Begin" on step 1, "Generate DNA" on step 5
       - "Generate DNA" button shows loading spinner when isSubmitting is true

    4. **Step components** (5 total):
       - **LifePhaseStep**: 4 large cards (not radio buttons) for life stage selection. Each card has an icon, title, and description. Luxury editorial feel.
       - **EmotionalOutcomeStep**: 5 slider inputs for emotional drivers. Each slider has a label, description, and visual representation. Use range inputs styled with rose gradient track.
       - **TravelModeStep**: 5 cards for travel mode selection with icons and descriptions. Single select.
       - **PrioritiesStep**: Checkboxes for lifestyle priorities from predefined list (Privacy, Family Legacy, Cultural Immersion, Adventure, Wellness, Philanthropy, Wealth Preservation, Social Recognition). Max 5 selections. Also a values text input.
       - **DiscretionStep**: Discretion tier cards (High/Medium/Standard) with plain-language explanations of what each tier means for data visibility. Risk tolerance selector.

    DESIGN: Each step should feel like a page in a luxury consultation book. Generous spacing, serif headings, warm tones. Not a cramped form. Each step gets a full viewport area.

    AVOID: Don't use Context API for wizard state -- useWizard hook handles it. Don't put all validation in one schema -- per-step validation is critical for UX. Don't use small radio buttons -- use large selectable cards for single-choice steps.
  </action>
  <verify>
    `npm run build` succeeds. Navigate to /intent/wizard:
    - Step 1 renders with 4 life phase cards
    - Selecting a card and clicking "Next" advances to step 2
    - Step 2 shows 5 sliders for emotional drivers
    - Back button works on all steps
    - Refreshing mid-wizard restores progress (localStorage)
    - Completing all 5 steps creates an intent profile via service
    - Redirects to /intent after completion
  </verify>
  <done>
    5-step intake wizard works end-to-end: life phase selection (INTN-01), emotional outcome capture (INTN-02), travel mode selection (INTN-03), priorities ranking (INTN-04), discretion preferences (INTN-05). Wizard state persists across refresh. Final submission generates Emotional Travel DNA (INTN-06) and creates intent profile. Reusable useWizard hook available for other wizards.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build Intent Profile view with alignment baseline and edit/regenerate flow</name>
  <files>
    src/app/(b2c)/intent/page.tsx
    src/components/b2c/intent/IntentProfileView.tsx
    src/components/b2c/intent/AlignmentBaseline.tsx
    src/components/b2c/intent/EmotionalDNACard.tsx
  </files>
  <action>
    1. **IntentProfileView.tsx** (INTN-07): Full intent profile display:
       - Shows all 5 wizard answers in a beautifully laid out summary
       - Life stage badge, travel mode badge, discretion tier
       - Emotional drivers displayed visually (use Recharts RadarChart from research example)
       - Priorities displayed as styled tags/pills
       - Values displayed as narrative text
       - "Edit Profile" button links to /intent/wizard (pre-populates wizard with existing data)
       - "Regenerate DNA" button recalculates alignment baseline

    2. **AlignmentBaseline.tsx** (INTN-08): Alignment baseline calculation and visualization:
       - Calls `services.intent.calculateAlignmentBaseline(profile)` to get score (0-100)
       - Displays as a large circular progress indicator with the score in the center
       - Color-coded: 0-40 amber, 40-70 teal, 70-100 rose (luxury palette)
       - Brief narrative text explaining what the score means:
         - Low (0-40): "Your profile suggests exploration -- many dimensions are yet to be defined"
         - Medium (40-70): "Your profile shows a clear direction with room for refinement"
         - High (70-100): "Your profile reveals a well-defined emotional landscape"

    3. **EmotionalDNACard.tsx** (INTN-06): A visual "DNA" card that summarizes the generated emotional profile:
       - Shows top 2 emotional drivers prominently
       - Shows life stage + travel mode combination as a "type" label (e.g., "Preserving Explorer")
       - Could be a styled card that the user might want to "save" or reference

    4. **Intent page.tsx** (INTN-07, INTN-09):
       - If no intent profile exists: show hero with CTA "Begin Your Journey" linking to /intent/wizard
       - If profile exists: show IntentProfileView with AlignmentBaseline and EmotionalDNACard
       - "Edit Profile" button: navigates to /intent/wizard with existing data pre-loaded (pass profile data via URL params or localStorage key)
       - "Regenerate" button (INTN-09): calls updateIntentProfile with recalculated data, shows loading state, refreshes view
       - Use Framer Motion for entrance animations
       - Use react-loading-skeleton while fetching profile

    DESIGN: The intent profile page should feel like viewing a personalized dossier. Think luxury portfolio presentation. The radar chart should be elegant, not a standard business chart.

    AVOID: Don't make the edit flow a modal -- navigate to the full wizard. Don't show raw JSON data -- everything must be narrative/visual.
  </action>
  <verify>
    `npm run build` succeeds. Navigate to /intent:
    - If no profile: shows "Begin Your Journey" CTA
    - After completing wizard: shows full profile with radar chart, alignment score, DNA card
    - "Edit Profile" navigates to wizard with existing data
    - "Regenerate" recalculates and updates the view
    - All sections render without errors
  </verify>
  <done>
    Intent Profile page displays complete profile with alignment baseline visualization (INTN-07, INTN-08). Emotional DNA card shows generated profile summary (INTN-06). Edit/regenerate flows work end-to-end (INTN-09). Empty state links to wizard. Build passes.
  </done>
</task>

</tasks>

<verification>
- `npm run build` completes without errors
- /intent/wizard: 5-step wizard completes end-to-end, creating an intent profile
- /intent: profile view shows radar chart, alignment baseline, DNA card
- Edit flow navigates to pre-populated wizard
- Regenerate recalculates alignment baseline
- Wizard state persists across browser refresh
- All INTN requirements (01-09) addressed
</verification>

<success_criteria>
1. UHNI can complete multi-step intake wizard (life phase -> emotional outcome -> travel mode -> priorities -> discretion) and generate Emotional Travel DNA (Success Criteria #2)
2. UHNI can view Intent Profile with alignment baseline calculation and edit/regenerate flow (Success Criteria #3)
3. Reusable useWizard hook with localStorage persistence available for future wizards
</success_criteria>

<output>
After completion, create `.planning/phases/03-b2c-sovereign-experience/03-02-SUMMARY.md`
</output>
